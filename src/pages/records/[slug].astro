---
import { getCollection } from 'astro:content';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import { getCatSvg } from '../../config/cats';

export async function getStaticPaths() {
  const records = await getCollection('cats');
  return records.map(record => ({
    params: { slug: record.slug },
    props: { record },
  }));
}

const { record } = Astro.props;
const { Content } = await record.render();

// 格式化日期为 YYYY-MM-DD
const formatDate = (date: Date) => {
  const year = date.getFullYear();
  const month = String(date.getMonth() + 1).padStart(2, '0');
  const day = String(date.getDate()).padStart(2, '0');
  return `${year}-${month}-${day}`;
};
---

<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{record.data.title} - HealPurr</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="stylesheet" href="/src/styles/fonts.css" is:inline>
</head>
<body class="bg-gradient-to-br from-slate-900 via-purple-950/30 to-slate-900 text-white min-h-screen">
  <Header />
  
  <main class="max-w-4xl mx-auto px-8 py-16">
    <a href="/" class="text-purple-400 hover:text-purple-300 mb-8 inline-flex items-center gap-2 text-lg transition-colors font-cute">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
      </svg>
      返回时间线
    </a>
    
    <article class="bg-gradient-to-br from-slate-800 to-slate-800/50 rounded-2xl p-10 border border-purple-500/20 backdrop-blur-sm shadow-2xl shadow-purple-500/10">
      <div class="mb-8">
        <div class="flex items-center gap-4 mb-4">
          <div class="relative">
            <img src={getCatSvg(record.data.cat)} alt={record.data.catName} class="w-12 h-12 drop-shadow-lg" />
            <div class="absolute inset-0 bg-purple-400/20 rounded-full blur-xl"></div>
          </div>
          <div>
            <h1 class="text-4xl font-bold font-cute">{record.data.title}</h1>
            <p class="text-gray-400 mt-2 text-lg font-cute-light">{record.data.catName} · <span class="font-cute-number">{formatDate(record.data.date)}</span></p>
          </div>
        </div>

        <div class="flex gap-4 text-base text-gray-400 flex-wrap">
          <span class="bg-purple-900/60 text-purple-200 px-4 py-2 rounded-full border border-purple-500/30 shadow-sm font-cute">{record.data.type}</span>
          {record.data.doctor && <span class="bg-slate-800 px-4 py-2 rounded-full border border-gray-700 font-cute">医生：{record.data.doctor}</span>}
          {record.data.weight && <span class="bg-slate-800 px-4 py-2 rounded-full border border-gray-700 font-cute">体重：<span class="font-cute-number">{record.data.weight}</span></span>}
          {record.data.temperature && <span class="bg-slate-800 px-4 py-2 rounded-full border border-gray-700 font-cute">体温：<span class="font-cute-number">{record.data.temperature}</span></span>}
        </div>
      </div>
      
      <div class="prose prose-invert prose-purple max-w-none">
        <Content />
      </div>
    </article>
  </main>

  <Footer />
</body>
</html>

<style is:global>
  .prose h2 {
    @apply text-3xl font-bold mt-10 mb-5 text-purple-300 font-cute-light;
  }
  .prose h3 {
    @apply text-2xl font-semibold mt-8 mb-4 text-purple-200 font-cute-light;
  }
  .prose p {
    @apply text-gray-300 leading-relaxed mb-5 text-lg font-cute;
  }
  .prose ul, .prose ol {
    @apply text-gray-300 space-y-3 mb-5 text-lg font-cute;
  }
  .prose strong {
    @apply text-white font-semibold text-purple-200 font-cute-bold;
  }
  .prose code {
    @apply bg-purple-900/40 px-3 py-1.5 rounded-lg text-purple-300 border border-purple-500/30 font-cute;
  }
  .prose li {
    @apply leading-relaxed;
  }
</style>