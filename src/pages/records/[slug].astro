---
import { getCollection } from 'astro:content';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import { getCatSvg } from '../../config/cats';

export async function getStaticPaths() {
  const records = await getCollection('cats');
  return records.map(record => ({
    params: { slug: record.slug },
    props: { record },
  }));
}

const { record } = Astro.props;
const { Content } = await record.render();

// 获取所有记录用于搜索
const allRecordsForSearch = await getCollection('cats');

// 格式化日期为 YYYY-MM-DD
const formatDate = (date: Date) => {
  const year = date.getFullYear();
  const month = String(date.getMonth() + 1).padStart(2, '0');
  const day = String(date.getDate()).padStart(2, '0');
  return `${year}-${month}-${day}`;
};
---

<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{record.data.title} - HealPurr</title>
  <link rel="stylesheet" href="/styles/fonts.css">
  <link rel="stylesheet" href="/styles/markdown.css">
</head>
<body class="bg-gradient-to-br from-stone-50 via-purple-100/20 to-stone-50 text-stone-900 min-h-screen dark:from-slate-900 dark:via-purple-950/30 dark:to-slate-900 dark:text-white">
  <Header records={allRecordsForSearch} />

  <main class="max-w-5xl mx-auto px-8 py-16">
    <a href="/" class="text-purple-700 hover:text-purple-600 mb-8 inline-flex items-center gap-2 text-lg transition-colors font-cute dark:text-purple-400 dark:hover:text-purple-300">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
      </svg>
      返回时间线
    </a>

    <article class="bg-gradient-to-br from-stone-50 to-stone-100/60 rounded-2xl p-10 border border-purple-700/20 backdrop-blur-sm shadow-2xl shadow-purple-700/10 dark:from-slate-800 dark:to-slate-800/50 dark:border-purple-500/20">
      <div class="mb-8">
        <div class="flex items-center gap-4 mb-4">
          <div class="relative">
            <img src={getCatSvg(record.data.cat)} alt={record.data.catName} class="w-12 h-12 drop-shadow-lg" />
            <div class="absolute inset-0 bg-purple-700/20 rounded-full blur-xl dark:bg-purple-400/20"></div>
          </div>
          <div>
            <h1 class="text-4xl font-bold font-cute">{record.data.title}</h1>
            <p class="text-stone-600 mt-2 text-lg font-cute-light dark:text-gray-400">{record.data.catName} · <span class="font-cute-number">{formatDate(record.data.date)}</span></p>
          </div>
        </div>

        <div class="flex gap-4 text-base text-stone-600 flex-wrap dark:text-gray-400">
          <span class="bg-purple-700/20 text-purple-700 px-4 py-2 rounded-full border border-purple-700/30 shadow-sm font-cute dark:bg-purple-900/60 dark:text-purple-200 dark:border-purple-500/30">{record.data.type}</span>
          {record.data.doctor && <span class="bg-stone-300 px-4 py-2 rounded-full border border-stone-400 font-cute dark:bg-slate-800 dark:border-gray-700">医生：{record.data.doctor}</span>}
          {record.data.weight && <span class="bg-stone-300 px-4 py-2 rounded-full border border-stone-400 font-cute dark:bg-slate-800 dark:border-gray-700">体重：<span class="font-cute-number">{record.data.weight}</span></span>}
          {record.data.temperature && <span class="bg-stone-300 px-4 py-2 rounded-full border border-stone-400 font-cute dark:bg-slate-800 dark:border-gray-700">体温：<span class="font-cute-number">{record.data.temperature}</span></span>}
        </div>
      </div>

      <div class="prose prose-invert prose-purple max-w-none">
        <Content />
      </div>
    </article>
  </main>

  <Footer />
</body>
</html>

<style is:global>
  /* 覆盖默认的 prose 样式，使用自定义的 markdown.css */
  .prose {
    font-family: 'Caveat', 'NotoSerifKhitanSmallScript-Regular', 'Microsoft YaHei', sans-serif;
  }
  
  /* 确保表格在移动端可以横向滚动 */
  .prose table {
    display: block;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
  }
  
  /* 优化代码块的可读性 */
  .prose pre {
    white-space: pre-wrap;
    word-wrap: break-word;
  }
</style>